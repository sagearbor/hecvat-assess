<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HECVAT Assessment Workflow</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      max-width: 1100px;
      margin: 0 auto;
      padding: 2rem;
      background: #f8f9fa;
      color: #1a1a2e;
    }
    h1 {
      text-align: center;
      margin-bottom: 0.25rem;
      color: #16213e;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 2rem;
      font-size: 0.95rem;
    }
    .mermaid {
      background: #fff;
      border-radius: 8px;
      padding: 2rem 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .legend {
      margin-top: 2rem;
      padding: 1.25rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      font-size: 0.9rem;
      line-height: 1.6;
    }
    .legend h3 { margin-top: 0; color: #16213e; }
    .legend code {
      background: #e9ecef;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <h1>HECVAT Assessment Workflow</h1>
  <p class="subtitle">Claude Code skill &mdash; EDUCAUSE HECVAT v4.1.4 (332 questions, 35 categories)</p>

  <div class="mermaid">
flowchart TD
    START(["/hecvat-assess"]) --> S1

    subgraph S1["Step 1: Bootstrap"]
        S1A["Resolve template\n(repo &gt; org &gt; blank)"] --> S1B["Parse HECVAT414.xlsx\n&rarr; hecvat-questions.json\n(332 questions)"]
    end

    S1 --> S2

    subgraph S2["Step 2: Version Check"]
        S2A["Scrape EDUCAUSE site"] --> S2B{"Newer version\navailable?"}
        S2B -- Yes --> S2C["Alert user\nOffer auto-download"]
        S2B -- No --> S2D["Continue with v4.1.4"]
        S2C --> S2D
    end

    S2 --> S3

    subgraph S3["Step 3: Repo Scan"]
        S3A["Detect languages\n& frameworks"] --> S3B["Pass 1: File discovery\n(Glob patterns)"]
        S3B --> S3C["Pass 2: Content analysis\n(Grep patterns by category)"]
        S3C --> S3D["Collect structured evidence\n{question_id, files, finding,\nassessment, confidence}"]
    end

    S3 --> S4

    subgraph S4["Step 4: Assessment Mapping"]
        S4A["Apply scoring rubric\n& context analysis"] --> S4B{"repo_assessable?"}
        S4B -- Yes --> S4C["Map to Yes/No/N/A\nwith evidence & confidence"]
        S4B -- No --> S4D["Mark: Requires\norg attestation"]
        S4C --> S4E["Write assessment-current.json"]
        S4D --> S4E
    end

    S4 --> S5

    subgraph S5["Step 5: Patch Generation"]
        S5A["Identify remediable gaps\n(answer = No)"] --> S5B["Generate unified diff\n&rarr; hecvat-remediation.patch"]
        S5B --> S5C["Create assessment-projected.json\n(patched Nos &rarr; Yes)"]
    end

    S5 --> S6

    subgraph S6["Step 6: Developer Checklist"]
        S6A["Group remaining gaps\ninto parallel work streams"] --> S6B["Generate tasks with\nacceptance criteria,\nfiles, tests, priority"]
        S6B --> S6C["Write hecvat-improvement-\ndeveloper-checklist.yaml"]
    end

    S6 --> S7

    subgraph S7["Step 7: Report Generation"]
        S7A["Fill template with\ncurrent assessment"] --> S7B["&rarr; hecvat-report-current.xlsx"]
        S7A --> S7C["Fill template with\nprojected assessment"] --> S7D["&rarr; hecvat-report-projected.xlsx"]
    end

    S7 --> SUMMARY["Print compliance summary\n(raw score, weighted score,\ncategory breakdown,\ntop remediation priorities)"]
    SUMMARY --> OUTPUT

    subgraph OUTPUT["Deliverables in ./docs/hecvat/"]
        O1["hecvat-report-current.xlsx"]
        O2["hecvat-report-projected.xlsx"]
        O3["hecvat-remediation.patch"]
        O4["hecvat-improvement-developer-checklist.yaml"]
        O5["assessment-current.json"]
        O6["assessment-projected.json"]
    end

    classDef stepBox fill:#e8f4fd,stroke:#2980b9,stroke-width:2px,color:#1a1a2e
    classDef startEnd fill:#2980b9,stroke:#1a6da0,color:#fff,stroke-width:2px
    classDef output fill:#d5f5e3,stroke:#27ae60,stroke-width:2px,color:#1a1a2e
    classDef decision fill:#fef9e7,stroke:#f39c12,stroke-width:2px,color:#1a1a2e

    class S1,S2,S3,S4,S5,S6,S7 stepBox
    class START,SUMMARY startEnd
    class OUTPUT,O1,O2,O3,O4,O5,O6 output
    class S2B,S4B decision
  </div>

  <div class="legend">
    <h3>Deliverables</h3>
    <table style="width:100%; border-collapse:collapse;">
      <tr><td style="padding:4px 8px;"><code>hecvat-report-current.xlsx</code></td><td>Filled HECVAT spreadsheet &mdash; current compliance state</td></tr>
      <tr><td style="padding:4px 8px;"><code>hecvat-report-projected.xlsx</code></td><td>Filled HECVAT spreadsheet &mdash; projected state after applying patch</td></tr>
      <tr><td style="padding:4px 8px;"><code>hecvat-remediation.patch</code></td><td>Unified diff for quick config/file fixes (<code>git apply</code> compatible)</td></tr>
      <tr><td style="padding:4px 8px;"><code>developer-checklist.yaml</code></td><td>Structured work streams for AI agents/developers to improve deeper gaps</td></tr>
      <tr><td style="padding:4px 8px;"><code>assessment-current.json</code></td><td>Machine-readable current assessment with evidence</td></tr>
      <tr><td style="padding:4px 8px;"><code>assessment-projected.json</code></td><td>Machine-readable projected assessment (post-patch)</td></tr>
    </table>
  </div>

  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        primaryColor: '#e8f4fd',
        primaryBorderColor: '#2980b9',
        primaryTextColor: '#1a1a2e',
        lineColor: '#5dade2',
        secondaryColor: '#fef9e7',
        tertiaryColor: '#d5f5e3',
        fontSize: '14px'
      },
      flowchart: {
        curve: 'basis',
        padding: 15,
        htmlLabels: true,
        useMaxWidth: true
      }
    });
  </script>
</body>
</html>
